<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resultado da Prova</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif; }
body { min-height:100vh; background:linear-gradient(160deg, #998675 0%, #b2a18f 45%, #e8e2dc 100%); display:flex; justify-content:center; align-items:center; }
.screen { width:100%; max-width:380px; height:100vh; background:rgba(255,255,255,0.95); display:flex; flex-direction:column; overflow:hidden; border:3px solid #998675; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.header { padding:48px 24px 24px; text-align:center; }
.header h1 { font-size:24px; color:#3f362d; }
.subtitle { font-size:14px; color:#6b5f55; }
.content { flex:1; padding:24px; display:flex; flex-direction:column; gap:16px; justify-content:center; align-items:center; text-align:center; }
.result { font-size:36px; font-weight:700; color:#3f362d; }
.info { font-size:16px; color:#4b423a; }
button { width:100%; height:50px; border:none; border-radius:14px; font-size:16px; font-weight:600; background:linear-gradient(135deg,#998675,#7f6d5c); color:#fff; cursor:pointer; margin-top:12px; }
button:active { opacity:0.9; }
</style>
</head>
<body>

<div class="screen">
  <header class="header">
    <h1>Resultado da Prova</h1>
    <p class="subtitle">Confira o desempenho do aluno</p>
  </header>

  <main class="content">
    <div class="result" id="acertos">0 / 0</div>
    <div class="info" id="infoProva">Prova X - Disciplina</div>
    <button id="btnNovaProva">Escanear nova prova</button>
    <button id="btnVoltar">Voltar</button>
  </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCZ77ugK5a3pw-U0NH43F2x1bu09sS5pJg",
  authDomain: "correcao-de-provas-f315d.firebaseapp.com",
  databaseURL: "https://correcao-de-provas-f315d-default-rtdb.firebaseio.com",
  projectId: "correcao-de-provas-f315d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* PEGAR ID DO GABARITO DA URL */
const params = new URLSearchParams(window.location.search);
const gabaritoId = params.get("gabaritoId");

/* ELEMENTOS */
const acertosEl = document.getElementById("acertos");
const infoEl = document.getElementById("infoProva");
const btnNovaProva = document.getElementById("btnNovaProva");
const btnVoltar = document.getElementById("btnVoltar");

/* CARREGAR RESULTADO */
async function carregarResultado() {
  if(!gabaritoId) return;

  try {
    const snapGabarito = await get(ref(db, `gabaritos/${gabaritoId}`));
    const snapProva = await get(ref(db, `provas/${gabaritoId}`));

    if(!snapGabarito.exists() || !snapProva.exists()) {
      acertosEl.textContent = "0 / 0";
      infoEl.textContent = "Prova não encontrada";
      return;
    }

    const gabarito = snapGabarito.val();
    const prova = snapProva.val();

    // Contar acertos (assumindo que as respostas dos alunos estão em 'respostas')
    const respostas = prova.respostasAluno || {};
    let acertos = 0;
    Object.keys(gabarito).forEach(q => {
      if(respostas[q] === gabarito[q]) acertos++;
    });

    acertosEl.textContent = `${acertos} / ${Object.keys(gabarito).length}`;
    infoEl.textContent = `${prova.nome} - ${prova.disciplina}`;
  } catch(err) {
    console.error(err);
    acertosEl.textContent = "0 / 0";
    infoEl.textContent = "Erro ao carregar resultado";
  }
}

btnNovaProva.addEventListener("click", () => {
  window.location.href = "escaneamentodoqrcode.html";
});

btnVoltar.addEventListener("click", () => {
  window.location.href = "escaneamentodogabarito.html";
});

carregarResultado();
</script>

</body>
</html>
