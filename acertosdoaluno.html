<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCZ77ugK5a3pw-U0NH43F2x1bu09sS5pJg",
  authDomain: "correcao-de-provas-f315d.firebaseapp.com",
  databaseURL: "https://correcao-de-provas-f315d-default-rtdb.firebaseio.com",
  projectId: "correcao-de-provas-f315d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* PEGAR PARÂMETROS DA URL */
const params = new URLSearchParams(window.location.search);
const provaId = params.get("provaId");
// Pegamos a nota que foi calculada na tela de escaneamento
const notaObtida = params.get("nota") || "0"; 

const acertosEl = document.getElementById("acertos");
const infoEl = document.getElementById("infoProva");
const btnNovaProva = document.getElementById("btnNovaProva");
const btnVoltar = document.getElementById("btnVoltar");

async function carregarResultado() {
  if(!provaId) {
    infoEl.textContent = "ID da prova ausente";
    return;
  }

  try {
    const snapProva = await get(ref(db, `provas/${provaId}`));

    if(!snapProva.exists()) {
      infoEl.textContent = "Prova não encontrada no sistema";
      return;
    }

    const prova = snapProva.val();
    const totalQuestoes = prova.quantidade || 0;

    // Exibe o resultado: Nota vinda da URL / Total vindo do Banco
    acertosEl.textContent = `${notaObtida} / ${totalQuestoes}`;
    infoEl.textContent = `${prova.nome} — ${prova.disciplina}`;
    
    // Feedback visual baseado na nota (opcional)
    if (parseInt(notaObtida) >= totalQuestoes / 2) {
        acertosEl.style.color = "#2d5a27"; // Verde se acertou mais da metade
    } else {
        acertosEl.style.color = "#a33b3b"; // Vermelho se acertou pouco
    }

  } catch(err) {
    console.error(err);
    infoEl.textContent = "Erro ao carregar dados";
  }
}

// BOTÕES
btnNovaProva.onclick = () => {
  // Ajuste o nome para o seu arquivo real de scanner de QR Code
  window.location.href = "escaneamentodoqrcode.html"; 
};

btnVoltar.onclick = () => {
  window.history.back();
};

carregarResultado();
</script>
