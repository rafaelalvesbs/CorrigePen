<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner de Gabarito</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: #000; overflow: hidden; color: white; text-align: center; }
        
        /* Container do Vídeo */
        #video-container { position: relative; width: 100vw; height: 100vh; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        /* Overlay de Scanner */
        .scan-overlay {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%; height: 60%;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 15px;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.6);
        }

        /* Pontos verdes animados (Simulação de detecção) */
        .dot {
            position: absolute; width: 15px; height: 15px;
            background: #00ff00; border-radius: 50%;
            box-shadow: 0 0 10px #00ff00; display: none;
        }

        .status-bar {
            position: absolute; top: 20px; width: 100%;
            padding: 10px; background: rgba(0,0,0,0.7);
        }
        
        .btn-capture {
            position: absolute; bottom: 40px; left: 50%;
            transform: translateX(-50%);
            padding: 15px 40px; border-radius: 30px;
            border: none; background: #998675; color: white;
            font-weight: bold; font-size: 16px; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="video-container">
    <video id="webcam" autoplay playsinline></video>
    <div class="scan-overlay">
        <div id="dot1" class="dot" style="top:20%; left:30%;"></div>
        <div id="dot2" class="dot" style="top:40%; left:70%;"></div>
        <div id="dot3" class="dot" style="top:60%; left:40%;"></div>
    </div>
    
    <div class="status-bar">
        <h2 id="msg">Alinhe o Gabarito</h2>
        <p id="sub-msg">Buscando marcações...</p>
    </div>

    <button id="btn-processar" class="btn-capture" style="display:none;">PROCESSAR NOTA</button>
</div>

<audio id="beep" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

<script type="module">
    const video = document.getElementById('webcam');
    const msg = document.getElementById('msg');
    const dots = document.querySelectorAll('.dot');
    const beep = document.getElementById('beep');
    const btn = document.getElementById('btn-processar');

    // Iniciar Câmera
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" } 
            });
            video.srcObject = stream;
            setTimeout(simularDeteccao, 2000);
        } catch (err) {
            alert("Erro ao acessar câmera: " + err);
        }
    }

    // Simulação visual da detecção de bolinhas
    function simularDeteccao() {
        msg.innerText = "Gabarito Identificado!";
        msg.style.color = "#00ff00";
        
        // Ativa os pontos verdes um a um com som
        dots.forEach((dot, index) => {
            setTimeout(() => {
                dot.style.display = 'block';
                beep.currentTime = 0;
                beep.play();
            }, index * 400);
        });

        setTimeout(() => {
            btn.style.display = 'block';
        }, 1500);
    }

    btn.onclick = () => {
        const params = new URLSearchParams(window.location.search);
        const provaId = params.get("provaId");
        // Aqui simulamos o cálculo da nota obtida
        const notaSimulada = Math.floor(Math.random() * 10); 
        window.location.href = `acertosdoaluno.html?provaId=${provaId}&nota=${notaSimulada}`;
    };

    startCamera();
</script>
</body>
</html>
